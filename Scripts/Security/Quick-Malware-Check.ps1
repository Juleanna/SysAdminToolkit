Write-Host "Suspicious processes (no path/vendor):"
Get-Process |
    Where-Object { -not $_.Path -and -not $_.Company } |
    Select-Object Name,Id,CPU,WS |
    Format-Table -AutoSize

Write-Host "`nWindows Defender status:"
$mpSvc = Get-Service -Name WinDefend -ErrorAction SilentlyContinue
if ($mpSvc -and $mpSvc.Status -eq 'Running') {
    try {
        Get-MpComputerStatus |
            Select-Object AMServiceEnabled,AntivirusEnabled,AntispywareEnabled,RealTimeProtectionEnabled |
            Format-List
    } catch {
        Write-Warning "Failed to query Defender status: $($_.Exception.Message)"
    }
} else {
    Write-Warning "Windows Defender service is not running (WinDefend). Start it or install AV to get status/threats."
}

Write-Host "`nRecent threats (if any):"
if ($mpSvc -and $mpSvc.Status -eq 'Running') {
    try {
        Get-MpThreat |
            Select-Object ThreatName,Resources,DetectionTime,ActionSuccess |
            Format-Table -AutoSize
    } catch {
        Write-Host "No threats recorded or Defender not available."
    }
} else {
    Write-Host "Threat list unavailable because Defender is not running."
}

Write-Host "`nAutoruns (Run keys):"
$runKeys = @(
    'HKLM:\Software\Microsoft\Windows\CurrentVersion\Run',
    'HKCU:\Software\Microsoft\Windows\CurrentVersion\Run'
)
foreach ($key in $runKeys) {
    if (-not (Test-Path $key)) { continue }

    $props = Get-ItemProperty -Path $key | Select-Object *
    foreach ($p in $props.PSObject.Properties) {
        if ($p.Name -match '^(PSPath|PSParentPath|PSChildName|PSDrive|PSProvider)$') { continue }
        Write-Host "$key -> $($p.Name) = $($p.Value)"
    }
}
